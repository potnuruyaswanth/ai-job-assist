import { z } from "zod";
import { db } from "../utils/db.js";
const config = {
  name: "LoginAPI",
  type: "api",
  path: "/auth/login",
  method: "POST",
  description: "User login endpoint",
  emits: [],
  flows: ["auth-flow"],
  bodySchema: z.object({
    email: z.string().email(),
    password: z.string()
  }),
  responseSchema: {
    200: z.object({
      message: z.string(),
      token: z.string(),
      user: z.object({
        id: z.string(),
        email: z.string(),
        name: z.string()
      })
    }),
    401: z.object({
      error: z.string()
    })
  }
};
const handler = async (req, { logger }) => {
  const { email, password } = req.body;
  logger.info("User login attempt", { email });
  const user = db.get("users", email);
  if (!user) {
    return {
      status: 401,
      body: { error: "Invalid credentials" }
    };
  }
  const passwordHash = Buffer.from(password).toString("base64");
  if (user.passwordHash !== passwordHash) {
    return {
      status: 401,
      body: { error: "Invalid credentials" }
    };
  }
  const token = `jwt_${user.id}_${Date.now()}_${Math.random().toString(36).substring(7)}`;
  const timestamp = (/* @__PURE__ */ new Date()).toISOString();
  db.set("sessions", token, {
    userId: user.id,
    email: user.email,
    createdAt: timestamp,
    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1e3).toISOString()
  });
  logger.info("User logged in successfully", { userId: user.id });
  return {
    status: 200,
    body: {
      message: "Login successful",
      token,
      user: {
        id: user.id,
        email: user.email,
        name: user.name
      }
    }
  };
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL2F1dGgvbG9naW4tYXBpLnN0ZXAudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB0eXBlIHsgQXBpUm91dGVDb25maWcsIEhhbmRsZXJzIH0gZnJvbSAnbW90aWEnO1xyXG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi91dGlscy9kYic7XHJcblxyXG5pbnRlcmZhY2UgVXNlciB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBwYXNzd29yZEhhc2g6IHN0cmluZztcclxuICBjcmVhdGVkQXQ6IHN0cmluZztcclxuICBwcm9maWxlPzogYW55O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgU2Vzc2lvbiB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICBjcmVhdGVkQXQ6IHN0cmluZztcclxuICBleHBpcmVzQXQ6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQXBpUm91dGVDb25maWcgPSB7XHJcbiAgbmFtZTogJ0xvZ2luQVBJJyxcclxuICB0eXBlOiAnYXBpJyxcclxuICBwYXRoOiAnL2F1dGgvbG9naW4nLFxyXG4gIG1ldGhvZDogJ1BPU1QnLFxyXG4gIGRlc2NyaXB0aW9uOiAnVXNlciBsb2dpbiBlbmRwb2ludCcsXHJcbiAgZW1pdHM6IFtdLFxyXG4gIGZsb3dzOiBbJ2F1dGgtZmxvdyddLFxyXG4gIGJvZHlTY2hlbWE6IHoub2JqZWN0KHtcclxuICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCksXHJcbiAgICBwYXNzd29yZDogei5zdHJpbmcoKVxyXG4gIH0pLFxyXG4gIHJlc3BvbnNlU2NoZW1hOiB7XHJcbiAgICAyMDA6IHoub2JqZWN0KHtcclxuICAgICAgbWVzc2FnZTogei5zdHJpbmcoKSxcclxuICAgICAgdG9rZW46IHouc3RyaW5nKCksXHJcbiAgICAgIHVzZXI6IHoub2JqZWN0KHtcclxuICAgICAgICBpZDogei5zdHJpbmcoKSxcclxuICAgICAgICBlbWFpbDogei5zdHJpbmcoKSxcclxuICAgICAgICBuYW1lOiB6LnN0cmluZygpXHJcbiAgICAgIH0pXHJcbiAgICB9KSxcclxuICAgIDQwMTogei5vYmplY3Qoe1xyXG4gICAgICBlcnJvcjogei5zdHJpbmcoKVxyXG4gICAgfSlcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgaGFuZGxlcjogSGFuZGxlcnNbJ0xvZ2luQVBJJ10gPSBhc3luYyAocmVxLCB7IGxvZ2dlciB9KSA9PiB7XHJcbiAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xyXG4gIFxyXG4gIGxvZ2dlci5pbmZvKCdVc2VyIGxvZ2luIGF0dGVtcHQnLCB7IGVtYWlsIH0pO1xyXG4gIFxyXG4gIC8vIEdldCB1c2VyIGZyb20gZmlsZS1iYXNlZCBkYlxyXG4gIGNvbnN0IHVzZXIgPSBkYi5nZXQ8VXNlcj4oJ3VzZXJzJywgZW1haWwpO1xyXG4gIGlmICghdXNlcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA0MDEsXHJcbiAgICAgIGJvZHk6IHsgZXJyb3I6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyB9XHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICAvLyBWZXJpZnkgcGFzc3dvcmQgKHNpbXBsaWZpZWQgLSB1c2UgYmNyeXB0IGluIHByb2R1Y3Rpb24pXHJcbiAgY29uc3QgcGFzc3dvcmRIYXNoID0gQnVmZmVyLmZyb20ocGFzc3dvcmQpLnRvU3RyaW5nKCdiYXNlNjQnKTtcclxuICBpZiAodXNlci5wYXNzd29yZEhhc2ggIT09IHBhc3N3b3JkSGFzaCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA0MDEsXHJcbiAgICAgIGJvZHk6IHsgZXJyb3I6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyB9XHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICAvLyBHZW5lcmF0ZSBKV1QgdG9rZW4gKHNpbXBsaWZpZWQgLSB1c2UgcHJvcGVyIEpXVCBpbiBwcm9kdWN0aW9uKVxyXG4gIGNvbnN0IHRva2VuID0gYGp3dF8ke3VzZXIuaWR9XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyl9YDtcclxuICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcbiAgXHJcbiAgLy8gU3RvcmUgc2Vzc2lvblxyXG4gIGRiLnNldDxTZXNzaW9uPignc2Vzc2lvbnMnLCB0b2tlbiwge1xyXG4gICAgdXNlcklkOiB1c2VyLmlkLFxyXG4gICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcclxuICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcclxuICB9KTtcclxuICBcclxuICBsb2dnZXIuaW5mbygnVXNlciBsb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5JywgeyB1c2VySWQ6IHVzZXIuaWQgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXR1czogMjAwLFxyXG4gICAgYm9keToge1xyXG4gICAgICBtZXNzYWdlOiAnTG9naW4gc3VjY2Vzc2Z1bCcsXHJcbiAgICAgIHRva2VuLFxyXG4gICAgICB1c2VyOiB7XHJcbiAgICAgICAgaWQ6IHVzZXIuaWQsXHJcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgICAgbmFtZTogdXNlci5uYW1lXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG59O1xyXG4iXSwKICAibWFwcGluZ3MiOiAiQUFDQSxTQUFTLFNBQVM7QUFDbEIsU0FBUyxVQUFVO0FBa0JaLE1BQU0sU0FBeUI7QUFBQSxFQUNwQyxNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixRQUFRO0FBQUEsRUFDUixhQUFhO0FBQUEsRUFDYixPQUFPLENBQUM7QUFBQSxFQUNSLE9BQU8sQ0FBQyxXQUFXO0FBQUEsRUFDbkIsWUFBWSxFQUFFLE9BQU87QUFBQSxJQUNuQixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU07QUFBQSxJQUN4QixVQUFVLEVBQUUsT0FBTztBQUFBLEVBQ3JCLENBQUM7QUFBQSxFQUNELGdCQUFnQjtBQUFBLElBQ2QsS0FBSyxFQUFFLE9BQU87QUFBQSxNQUNaLFNBQVMsRUFBRSxPQUFPO0FBQUEsTUFDbEIsT0FBTyxFQUFFLE9BQU87QUFBQSxNQUNoQixNQUFNLEVBQUUsT0FBTztBQUFBLFFBQ2IsSUFBSSxFQUFFLE9BQU87QUFBQSxRQUNiLE9BQU8sRUFBRSxPQUFPO0FBQUEsUUFDaEIsTUFBTSxFQUFFLE9BQU87QUFBQSxNQUNqQixDQUFDO0FBQUEsSUFDSCxDQUFDO0FBQUEsSUFDRCxLQUFLLEVBQUUsT0FBTztBQUFBLE1BQ1osT0FBTyxFQUFFLE9BQU87QUFBQSxJQUNsQixDQUFDO0FBQUEsRUFDSDtBQUNGO0FBRU8sTUFBTSxVQUFnQyxPQUFPLEtBQUssRUFBRSxPQUFPLE1BQU07QUFDdEUsUUFBTSxFQUFFLE9BQU8sU0FBUyxJQUFJLElBQUk7QUFFaEMsU0FBTyxLQUFLLHNCQUFzQixFQUFFLE1BQU0sQ0FBQztBQUczQyxRQUFNLE9BQU8sR0FBRyxJQUFVLFNBQVMsS0FBSztBQUN4QyxNQUFJLENBQUMsTUFBTTtBQUNULFdBQU87QUFBQSxNQUNMLFFBQVE7QUFBQSxNQUNSLE1BQU0sRUFBRSxPQUFPLHNCQUFzQjtBQUFBLElBQ3ZDO0FBQUEsRUFDRjtBQUdBLFFBQU0sZUFBZSxPQUFPLEtBQUssUUFBUSxFQUFFLFNBQVMsUUFBUTtBQUM1RCxNQUFJLEtBQUssaUJBQWlCLGNBQWM7QUFDdEMsV0FBTztBQUFBLE1BQ0wsUUFBUTtBQUFBLE1BQ1IsTUFBTSxFQUFFLE9BQU8sc0JBQXNCO0FBQUEsSUFDdkM7QUFBQSxFQUNGO0FBR0EsUUFBTSxRQUFRLE9BQU8sS0FBSyxFQUFFLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRSxTQUFTLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNyRixRQUFNLGFBQVksb0JBQUksS0FBSyxHQUFFLFlBQVk7QUFHekMsS0FBRyxJQUFhLFlBQVksT0FBTztBQUFBLElBQ2pDLFFBQVEsS0FBSztBQUFBLElBQ2IsT0FBTyxLQUFLO0FBQUEsSUFDWixXQUFXO0FBQUEsSUFDWCxXQUFXLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssS0FBSyxHQUFJLEVBQUUsWUFBWTtBQUFBLEVBQ3BFLENBQUM7QUFFRCxTQUFPLEtBQUssK0JBQStCLEVBQUUsUUFBUSxLQUFLLEdBQUcsQ0FBQztBQUU5RCxTQUFPO0FBQUEsSUFDTCxRQUFRO0FBQUEsSUFDUixNQUFNO0FBQUEsTUFDSixTQUFTO0FBQUEsTUFDVDtBQUFBLE1BQ0EsTUFBTTtBQUFBLFFBQ0osSUFBSSxLQUFLO0FBQUEsUUFDVCxPQUFPLEtBQUs7QUFBQSxRQUNaLE1BQU0sS0FBSztBQUFBLE1BQ2I7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUNGOyIsCiAgIm5hbWVzIjogW10KfQo=
