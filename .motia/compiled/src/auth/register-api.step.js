import { z } from "zod";
import { db } from "../utils/db.js";
const config = {
  name: "RegisterAPI",
  type: "api",
  path: "/auth/register",
  method: "POST",
  description: "User registration endpoint",
  emits: [],
  flows: ["auth-flow"],
  bodySchema: z.object({
    email: z.string().email(),
    password: z.string().min(8),
    name: z.string().min(2)
  }),
  responseSchema: {
    201: z.object({
      message: z.string(),
      token: z.string(),
      user: z.object({
        id: z.string(),
        email: z.string(),
        name: z.string()
      })
    }),
    400: z.object({
      error: z.string()
    })
  }
};
const handler = async (req, { logger }) => {
  const { email, password, name } = req.body;
  logger.info("User registration attempt", { email });
  const existingUser = db.get("users", email);
  if (existingUser) {
    return {
      status: 400,
      body: { error: "User already exists" }
    };
  }
  const userId = `user_${Date.now()}_${Math.random().toString(36).substring(7)}`;
  const timestamp = (/* @__PURE__ */ new Date()).toISOString();
  const passwordHash = Buffer.from(password).toString("base64");
  db.set("users", email, {
    id: userId,
    email,
    name,
    passwordHash,
    createdAt: timestamp,
    profile: null
  });
  const token = `jwt_${userId}_${Date.now()}_${Math.random().toString(36).substring(7)}`;
  db.set("sessions", token, {
    userId,
    email,
    createdAt: timestamp,
    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1e3).toISOString()
  });
  logger.info("User registered successfully", { userId, email });
  return {
    status: 201,
    body: {
      message: "User registered successfully",
      token,
      user: {
        id: userId,
        email,
        name
      }
    }
  };
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL2F1dGgvcmVnaXN0ZXItYXBpLnN0ZXAudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB0eXBlIHsgQXBpUm91dGVDb25maWcsIEhhbmRsZXJzIH0gZnJvbSAnbW90aWEnO1xyXG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi91dGlscy9kYic7XHJcblxyXG5pbnRlcmZhY2UgVXNlciB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBwYXNzd29yZEhhc2g6IHN0cmluZztcclxuICBjcmVhdGVkQXQ6IHN0cmluZztcclxuICBwcm9maWxlPzogYW55O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgU2Vzc2lvbiB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICBjcmVhdGVkQXQ6IHN0cmluZztcclxuICBleHBpcmVzQXQ6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQXBpUm91dGVDb25maWcgPSB7XHJcbiAgbmFtZTogJ1JlZ2lzdGVyQVBJJyxcclxuICB0eXBlOiAnYXBpJyxcclxuICBwYXRoOiAnL2F1dGgvcmVnaXN0ZXInLFxyXG4gIG1ldGhvZDogJ1BPU1QnLFxyXG4gIGRlc2NyaXB0aW9uOiAnVXNlciByZWdpc3RyYXRpb24gZW5kcG9pbnQnLFxyXG4gIGVtaXRzOiBbXSxcclxuICBmbG93czogWydhdXRoLWZsb3cnXSxcclxuICBib2R5U2NoZW1hOiB6Lm9iamVjdCh7XHJcbiAgICBlbWFpbDogei5zdHJpbmcoKS5lbWFpbCgpLFxyXG4gICAgcGFzc3dvcmQ6IHouc3RyaW5nKCkubWluKDgpLFxyXG4gICAgbmFtZTogei5zdHJpbmcoKS5taW4oMilcclxuICB9KSxcclxuICByZXNwb25zZVNjaGVtYToge1xyXG4gICAgMjAxOiB6Lm9iamVjdCh7XHJcbiAgICAgIG1lc3NhZ2U6IHouc3RyaW5nKCksXHJcbiAgICAgIHRva2VuOiB6LnN0cmluZygpLFxyXG4gICAgICB1c2VyOiB6Lm9iamVjdCh7XHJcbiAgICAgICAgaWQ6IHouc3RyaW5nKCksXHJcbiAgICAgICAgZW1haWw6IHouc3RyaW5nKCksXHJcbiAgICAgICAgbmFtZTogei5zdHJpbmcoKVxyXG4gICAgICB9KVxyXG4gICAgfSksXHJcbiAgICA0MDA6IHoub2JqZWN0KHtcclxuICAgICAgZXJyb3I6IHouc3RyaW5nKClcclxuICAgIH0pXHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXI6IEhhbmRsZXJzWydSZWdpc3RlckFQSSddID0gYXN5bmMgKHJlcSwgeyBsb2dnZXIgfSkgPT4ge1xyXG4gIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkLCBuYW1lIH0gPSByZXEuYm9keTtcclxuICBcclxuICBsb2dnZXIuaW5mbygnVXNlciByZWdpc3RyYXRpb24gYXR0ZW1wdCcsIHsgZW1haWwgfSk7XHJcbiAgXHJcbiAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xyXG4gIGNvbnN0IGV4aXN0aW5nVXNlciA9IGRiLmdldDxVc2VyPigndXNlcnMnLCBlbWFpbCk7XHJcbiAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA0MDAsXHJcbiAgICAgIGJvZHk6IHsgZXJyb3I6ICdVc2VyIGFscmVhZHkgZXhpc3RzJyB9XHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICBjb25zdCB1c2VySWQgPSBgdXNlcl8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfWA7XHJcbiAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gIFxyXG4gIC8vIEhhc2ggcGFzc3dvcmQgKGluIHByb2R1Y3Rpb24sIHVzZSBiY3J5cHQpXHJcbiAgY29uc3QgcGFzc3dvcmRIYXNoID0gQnVmZmVyLmZyb20ocGFzc3dvcmQpLnRvU3RyaW5nKCdiYXNlNjQnKTtcclxuICBcclxuICAvLyBTdG9yZSB1c2VyIGluIGZpbGUtYmFzZWQgZGJcclxuICBkYi5zZXQ8VXNlcj4oJ3VzZXJzJywgZW1haWwsIHtcclxuICAgIGlkOiB1c2VySWQsXHJcbiAgICBlbWFpbCxcclxuICAgIG5hbWUsXHJcbiAgICBwYXNzd29yZEhhc2gsXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcclxuICAgIHByb2ZpbGU6IG51bGxcclxuICB9KTtcclxuICBcclxuICAvLyBHZW5lcmF0ZSBKV1QgdG9rZW4gZm9yIGF1dG8tbG9naW4gYWZ0ZXIgcmVnaXN0cmF0aW9uXHJcbiAgY29uc3QgdG9rZW4gPSBgand0XyR7dXNlcklkfV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfWA7XHJcbiAgXHJcbiAgLy8gU3RvcmUgc2Vzc2lvblxyXG4gIGRiLnNldDxTZXNzaW9uPignc2Vzc2lvbnMnLCB0b2tlbiwge1xyXG4gICAgdXNlcklkLFxyXG4gICAgZW1haWwsXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcclxuICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcclxuICB9KTtcclxuICBcclxuICBsb2dnZXIuaW5mbygnVXNlciByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseScsIHsgdXNlcklkLCBlbWFpbCB9KTtcclxuICBcclxuICByZXR1cm4ge1xyXG4gICAgc3RhdHVzOiAyMDEsXHJcbiAgICBib2R5OiB7XHJcbiAgICAgIG1lc3NhZ2U6ICdVc2VyIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5JyxcclxuICAgICAgdG9rZW4sXHJcbiAgICAgIHVzZXI6IHtcclxuICAgICAgICBpZDogdXNlcklkLFxyXG4gICAgICAgIGVtYWlsLFxyXG4g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
