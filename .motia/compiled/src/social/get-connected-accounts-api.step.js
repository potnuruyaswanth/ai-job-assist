import { z } from "zod";
const config = {
  name: "GetConnectedAccountsAPI",
  type: "api",
  path: "/social/accounts",
  method: "GET",
  description: "Get user connected social media accounts",
  emits: [],
  flows: ["social-media-flow"],
  responseSchema: {
    200: z.object({
      accounts: z.array(z.object({
        platform: z.string(),
        connected: z.boolean(),
        connectedAt: z.string().optional()
      }))
    }),
    401: z.object({
      error: z.string()
    })
  }
};
const SUPPORTED_PLATFORMS = ["twitter", "facebook", "instagram", "linkedin"];
const handler = async (req, { logger, state }) => {
  const authHeader = req.headers.authorization;
  if (!authHeader) {
    return {
      status: 401,
      body: { error: "Authorization required" }
    };
  }
  const token = authHeader.replace("Bearer ", "");
  const session = await state.get("sessions", token);
  if (!session) {
    return {
      status: 401,
      body: { error: "Invalid session" }
    };
  }
  logger.info("Fetching connected accounts", { userId: session.userId });
  const accounts = [];
  for (const platform of SUPPORTED_PLATFORMS) {
    const socialAccountId = `social_${session.userId}_${platform}`;
    const account = await state.get("social_accounts", socialAccountId);
    accounts.push({
      platform,
      connected: !!account,
      connectedAt: account?.connectedAt
    });
  }
  return {
    status: 200,
    body: { accounts }
  };
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL3NvY2lhbC9nZXQtY29ubmVjdGVkLWFjY291bnRzLWFwaS5zdGVwLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgdHlwZSB7IEFwaVJvdXRlQ29uZmlnLCBIYW5kbGVycyB9IGZyb20gJ21vdGlhJztcclxuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnOiBBcGlSb3V0ZUNvbmZpZyA9IHtcclxuICBuYW1lOiAnR2V0Q29ubmVjdGVkQWNjb3VudHNBUEknLFxyXG4gIHR5cGU6ICdhcGknLFxyXG4gIHBhdGg6ICcvc29jaWFsL2FjY291bnRzJyxcclxuICBtZXRob2Q6ICdHRVQnLFxyXG4gIGRlc2NyaXB0aW9uOiAnR2V0IHVzZXIgY29ubmVjdGVkIHNvY2lhbCBtZWRpYSBhY2NvdW50cycsXHJcbiAgZW1pdHM6IFtdLFxyXG4gIGZsb3dzOiBbJ3NvY2lhbC1tZWRpYS1mbG93J10sXHJcbiAgcmVzcG9uc2VTY2hlbWE6IHtcclxuICAgIDIwMDogei5vYmplY3Qoe1xyXG4gICAgICBhY2NvdW50czogei5hcnJheSh6Lm9iamVjdCh7XHJcbiAgICAgICAgcGxhdGZvcm06IHouc3RyaW5nKCksXHJcbiAgICAgICAgY29ubmVjdGVkOiB6LmJvb2xlYW4oKSxcclxuICAgICAgICBjb25uZWN0ZWRBdDogei5zdHJpbmcoKS5vcHRpb25hbCgpXHJcbiAgICAgIH0pKVxyXG4gICAgfSksXHJcbiAgICA0MDE6IHoub2JqZWN0KHtcclxuICAgICAgZXJyb3I6IHouc3RyaW5nKClcclxuICAgIH0pXHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgU1VQUE9SVEVEX1BMQVRGT1JNUyA9IFsndHdpdHRlcicsICdmYWNlYm9vaycsICdpbnN0YWdyYW0nLCAnbGlua2VkaW4nXTtcclxuXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVyOiBIYW5kbGVyc1snR2V0Q29ubmVjdGVkQWNjb3VudHNBUEknXSA9IGFzeW5jIChyZXEsIHsgbG9nZ2VyLCBzdGF0ZSB9KSA9PiB7XHJcbiAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgaWYgKCFhdXRoSGVhZGVyKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6IDQwMSxcclxuICAgICAgYm9keTogeyBlcnJvcjogJ0F1dGhvcml6YXRpb24gcmVxdWlyZWQnIH1cclxuICAgIH07XHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5yZXBsYWNlKCdCZWFyZXIgJywgJycpO1xyXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzdGF0ZS5nZXQoJ3Nlc3Npb25zJywgdG9rZW4pO1xyXG4gIGlmICghc2Vzc2lvbikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA0MDEsXHJcbiAgICAgIGJvZHk6IHsgZXJyb3I6ICdJbnZhbGlkIHNlc3Npb24nIH1cclxuICAgIH07XHJcbiAgfVxyXG4gIFxyXG4gIGxvZ2dlci5pbmZvKCdGZXRjaGluZyBjb25uZWN0ZWQgYWNjb3VudHMnLCB7IHVzZXJJZDogc2Vzc2lvbi51c2VySWQgfSk7XHJcbiAgXHJcbiAgY29uc3QgYWNjb3VudHMgPSBbXTtcclxuICBmb3IgKGNvbnN0IHBsYXRmb3JtIG9mIFNVUFBPUlRFRF9QTEFURk9STVMpIHtcclxuICAgIGNvbnN0IHNvY2lhbEFjY291bnRJZCA9IGBzb2NpYWxfJHtzZXNzaW9uLnVzZXJJZH1fJHtwbGF0Zm9ybX1gO1xyXG4gICAgY29uc3QgYWNjb3VudCA9IGF3YWl0IHN0YXRlLmdldCgnc29jaWFsX2FjY291bnRzJywgc29jaWFsQWNjb3VudElkKTtcclxuICAgIFxyXG4gICAgYWNjb3VudHMucHVzaCh7XHJcbiAgICAgIHBsYXRmb3JtLFxyXG4gICAgICBjb25uZWN0ZWQ6ICEhYWNjb3VudCxcclxuICAgICAgY29ubmVjdGVkQXQ6IGFjY291bnQ/LmNvbm5lY3RlZEF0XHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXR1czogMjAwLFxyXG4gICAgYm9keTogeyBhY2NvdW50cyB9XHJcbiAgfTtcclxufTtcclxuIl0sCiAgIm1hcHBpbmdzIjogIkFBQ0EsU0FBUyxTQUFTO0FBRVgsTUFBTSxTQUF5QjtBQUFBLEVBQ3BDLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLFFBQVE7QUFBQSxFQUNSLGFBQWE7QUFBQSxFQUNiLE9BQU8sQ0FBQztBQUFBLEVBQ1IsT0FBTyxDQUFDLG1CQUFtQjtBQUFBLEVBQzNCLGdCQUFnQjtBQUFBLElBQ2QsS0FBSyxFQUFFLE9BQU87QUFBQSxNQUNaLFVBQVUsRUFBRSxNQUFNLEVBQUUsT0FBTztBQUFBLFFBQ3pCLFVBQVUsRUFBRSxPQUFPO0FBQUEsUUFDbkIsV0FBVyxFQUFFLFFBQVE7QUFBQSxRQUNyQixhQUFhLEVBQUUsT0FBTyxFQUFFLFNBQVM7QUFBQSxNQUNuQyxDQUFDLENBQUM7QUFBQSxJQUNKLENBQUM7QUFBQSxJQUNELEtBQUssRUFBRSxPQUFPO0FBQUEsTUFDWixPQUFPLEVBQUUsT0FBTztBQUFBLElBQ2xCLENBQUM7QUFBQSxFQUNIO0FBQ0Y7QUFFQSxNQUFNLHNCQUFzQixDQUFDLFdBQVcsWUFBWSxhQUFhLFVBQVU7QUFFcEUsTUFBTSxVQUErQyxPQUFPLEtBQUssRUFBRSxRQUFRLE1BQU0sTUFBTTtBQUM1RixRQUFNLGFBQWEsSUFBSSxRQUFRO0FBQy9CLE1BQUksQ0FBQyxZQUFZO0FBQ2YsV0FBTztBQUFBLE1BQ0wsUUFBUTtBQUFBLE1BQ1IsTUFBTSxFQUFFLE9BQU8seUJBQXlCO0FBQUEsSUFDMUM7QUFBQSxFQUNGO0FBRUEsUUFBTSxRQUFRLFdBQVcsUUFBUSxXQUFXLEVBQUU7QUFDOUMsUUFBTSxVQUFVLE1BQU0sTUFBTSxJQUFJLFlBQVksS0FBSztBQUNqRCxNQUFJLENBQUMsU0FBUztBQUNaLFdBQU87QUFBQSxNQUNMLFFBQVE7QUFBQSxNQUNSLE1BQU0sRUFBRSxPQUFPLGtCQUFrQjtBQUFBLElBQ25DO0FBQUEsRUFDRjtBQUVBLFNBQU8sS0FBSywrQkFBK0IsRUFBRSxRQUFRLFFBQVEsT0FBTyxDQUFDO0FBRXJFLFFBQU0sV0FBVyxDQUFDO0FBQ2xCLGFBQVcsWUFBWSxxQkFBcUI7QUFDMUMsVUFBTSxrQkFBa0IsVUFBVSxRQUFRLE1BQU0sSUFBSSxRQUFRO0FBQzVELFVBQU0sVUFBVSxNQUFNLE1BQU0sSUFBSSxtQkFBbUIsZUFBZTtBQUVsRSxhQUFTLEtBQUs7QUFBQSxNQUNaO0FBQUEsTUFDQSxXQUFXLENBQUMsQ0FBQztBQUFBLE1BQ2IsYUFBYSxTQUFTO0FBQUEsSUFDeEIsQ0FBQztBQUFBLEVBQ0g7QUFFQSxTQUFPO0FBQUEsSUFDTCxRQUFRO0FBQUEsSUFDUixNQUFNLEVBQUUsU0FBUztBQUFBLEVBQ25CO0FBQ0Y7IiwKICAibmFtZXMiOiBbXQp9Cg==
