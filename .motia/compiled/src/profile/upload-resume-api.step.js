import { z } from "zod";
import { db } from "../utils/db.js";
const config = {
  name: "UploadResumeAPI",
  type: "api",
  path: "/profile/resume/upload",
  method: "POST",
  description: "Upload and parse resume for profile creation",
  emits: [],
  flows: ["profile-flow"],
  bodySchema: z.object({
    fileName: z.string(),
    fileType: z.enum(["pdf", "docx"]),
    fileContent: z.string(),
    // Base64 encoded
    fileSize: z.number()
  }),
  responseSchema: {
    200: z.object({
      message: z.string(),
      resumeId: z.string(),
      status: z.string()
    }),
    400: z.object({
      error: z.string()
    })
  }
};
const MAX_FILE_SIZE = 5 * 1024 * 1024;
const handler = async (req, { logger }) => {
  const { fileName, fileType, fileContent, fileSize } = req.body;
  const authHeader = req.headers.authorization;
  if (!authHeader) {
    return {
      status: 400,
      body: { error: "Authorization required" }
    };
  }
  const token = authHeader.replace("Bearer ", "");
  const session = db.get("sessions", token);
  if (!session) {
    return {
      status: 400,
      body: { error: "Invalid session" }
    };
  }
  if (fileSize > MAX_FILE_SIZE) {
    return {
      status: 400,
      body: { error: "File size exceeds 5MB limit" }
    };
  }
  const resumeId = `resume_${Date.now()}_${Math.random().toString(36).substring(7)}`;
  const timestamp = (/* @__PURE__ */ new Date()).toISOString();
  logger.info("Resume upload started", { resumeId, fileName, fileType, userId: session.userId });
  const mockUrl = `https://storage.example.com/resumes/${resumeId}/${fileName}`;
  db.set("resumes", resumeId, {
    id: resumeId,
    userId: session.userId,
    fileName,
    fileType,
    fileUrl: mockUrl,
    status: "uploaded",
    uploadedAt: timestamp
  });
  const profile = db.get("user_profiles", session.userId) || { userId: session.userId };
  profile.resumeId = resumeId;
  db.set("user_profiles", session.userId, profile);
  return {
    status: 200,
    body: {
      message: "Resume uploaded successfully.",
      resumeId,
      status: "uploaded"
    }
  };
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL3Byb2ZpbGUvdXBsb2FkLXJlc3VtZS1hcGkuc3RlcC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHR5cGUgeyBBcGlSb3V0ZUNvbmZpZywgSGFuZGxlcnMgfSBmcm9tICdtb3RpYSc7XHJcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xyXG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uL3V0aWxzL2RiJztcclxuXHJcbmludGVyZmFjZSBTZXNzaW9uIHtcclxuICB1c2VySWQ6IHN0cmluZztcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xyXG4gIGV4cGlyZXNBdDogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUmVzdW1lIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHVzZXJJZDogc3RyaW5nO1xyXG4gIGZpbGVOYW1lOiBzdHJpbmc7XHJcbiAgZmlsZVR5cGU6IHN0cmluZztcclxuICBmaWxlVXJsOiBzdHJpbmc7XHJcbiAgc3RhdHVzOiBzdHJpbmc7XHJcbiAgdXBsb2FkZWRBdDogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnOiBBcGlSb3V0ZUNvbmZpZyA9IHtcclxuICBuYW1lOiAnVXBsb2FkUmVzdW1lQVBJJyxcclxuICB0eXBlOiAnYXBpJyxcclxuICBwYXRoOiAnL3Byb2ZpbGUvcmVzdW1lL3VwbG9hZCcsXHJcbiAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgZGVzY3JpcHRpb246ICdVcGxvYWQgYW5kIHBhcnNlIHJlc3VtZSBmb3IgcHJvZmlsZSBjcmVhdGlvbicsXHJcbiAgZW1pdHM6IFtdLFxyXG4gIGZsb3dzOiBbJ3Byb2ZpbGUtZmxvdyddLFxyXG4gIGJvZHlTY2hlbWE6IHoub2JqZWN0KHtcclxuICAgIGZpbGVOYW1lOiB6LnN0cmluZygpLFxyXG4gICAgZmlsZVR5cGU6IHouZW51bShbJ3BkZicsICdkb2N4J10pLFxyXG4gICAgZmlsZUNvbnRlbnQ6IHouc3RyaW5nKCksIC8vIEJhc2U2NCBlbmNvZGVkXHJcbiAgICBmaWxlU2l6ZTogei5udW1iZXIoKVxyXG4gIH0pLFxyXG4gIHJlc3BvbnNlU2NoZW1hOiB7XHJcbiAgICAyMDA6IHoub2JqZWN0KHtcclxuICAgICAgbWVzc2FnZTogei5zdHJpbmcoKSxcclxuICAgICAgcmVzdW1lSWQ6IHouc3RyaW5nKCksXHJcbiAgICAgIHN0YXR1czogei5zdHJpbmcoKVxyXG4gICAgfSksXHJcbiAgICA0MDA6IHoub2JqZWN0KHtcclxuICAgICAgZXJyb3I6IHouc3RyaW5nKClcclxuICAgIH0pXHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgTUFYX0ZJTEVfU0laRSA9IDUgKiAxMDI0ICogMTAyNDsgLy8gNU1CXHJcblxyXG5leHBvcnQgY29uc3QgaGFuZGxlcjogSGFuZGxlcnNbJ1VwbG9hZFJlc3VtZUFQSSddID0gYXN5bmMgKHJlcSwgeyBsb2dnZXIgfSkgPT4ge1xyXG4gIGNvbnN0IHsgZmlsZU5hbWUsIGZpbGVUeXBlLCBmaWxlQ29udGVudCwgZmlsZVNpemUgfSA9IHJlcS5ib2R5O1xyXG4gIFxyXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG4gIGlmICghYXV0aEhlYWRlcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA0MDAsXHJcbiAgICAgIGJvZHk6IHsgZXJyb3I6ICdBdXRob3JpemF0aW9uIHJlcXVpcmVkJyB9XHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIucmVwbGFjZSgnQmVhcmVyICcsICcnKTtcclxuICBjb25zdCBzZXNzaW9uID0gZGIuZ2V0PFNlc3Npb24+KCdzZXNzaW9ucycsIHRva2VuKTtcclxuICBpZiAoIXNlc3Npb24pIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN0YXR1czogNDAwLFxyXG4gICAgICBib2R5OiB7IGVycm9yOiAnSW52YWxpZCBzZXNzaW9uJyB9XHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICBpZiAoZmlsZVNpemUgPiBNQVhfRklMRV9TSVpFKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6IDQwMCxcclxuICAgICAgYm9keTogeyBlcnJvcjogJ0ZpbGUgc2l6ZSBleGNlZWRzIDVNQiBsaW1pdCcgfVxyXG4gICAgfTtcclxuICB9XHJcbiAgXHJcbiAgY29uc3QgcmVzdW1lSWQgPSBgcmVzdW1lXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyl9YDtcclxuICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcbiAgXHJcbiAgbG9nZ2VyLmluZm8oJ1Jlc3VtZSB1cGxvYWQgc3RhcnRlZCcsIHsgcmVzdW1lSWQsIGZpbGVOYW1lLCBmaWxlVHlwZSwgdXNlcklkOiBzZXNzaW9uLnVzZXJJZCB9KTtcclxuICBcclxuICAvLyBJbiBwcm9kdWN0aW9uLCB1cGxvYWQgdG8gUzMvQ2xvdWRpbmFyeVxyXG4gIGNvbnN0IG1vY2tVcmwgPSBgaHR0cHM6Ly9zdG9yYWdlLmV4YW1wbGUuY29tL3Jlc3VtZXMvJHtyZXN1bWVJZH0vJHtmaWxlTmFtZX1gO1xyXG4gIFxyXG4gIC8vIFN0b3JlIHJlc3VtZSBtZXRhZGF0YVxyXG4gIGRiLnNldDxSZXN1bWU+KCdyZXN1bWVzJywgcmVzdW1lSWQsIHtcclxuICAgIGlkOiByZXN1bWVJZCxcclxuICAgIHVzZXJJZDogc2Vzc2lvbi51c2VySWQsXHJcbiAgICBmaWxlTmFtZSxcclxuICAgIGZpbGVUeXBlLFxyXG4gICAgZmlsZVVybDogbW9ja1VybCxcclxuICAgIHN0YXR1czogJ3VwbG9hZGVkJyxcclxuICAgIHVwbG9hZGVkQXQ6IHRpbWVzdGFtcFxyXG4gIH0pO1xyXG4gIFxyXG4gIC8vIFVwZGF0ZSB1c2VyIHByb2ZpbGUgd2l0aCByZXN1bWUgSURcclxuICBjb25zdCBwcm9maWxlID0gZGIuZ2V0PGFueT4oJ3VzZXJfcHJvZmlsZXMnLCBzZXNzaW9uLnVzZXJJZCkgfHwgeyB1c2VySWQ6IHNlc3Npb24udXNlcklkIH07XHJcbiAgcHJvZmlsZS5yZXN1bWVJZCA9IHJlc3VtZUlkO1xyXG4gIGRiLnNldCgndXNlcl9wcm9maWxlcycsIHNlc3Npb24udXNlcklkLCBwcm9maWxlKTtcclxuICBcclxuICByZXR1cm4ge1xyXG4gICAgc3RhdHVzOiAyMDAsXHJcbiAgICBib2R5OiB7XHJcbiAgICAgIG1lc3NhZ2U6ICdSZXN1bWUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5LicsXHJcbiAgICAgIHJlc3VtZUlkLFxyXG4gICAgICBzdGF0dXM6ICd1cGxvYWRlZCdcclxuICAgIH1cclxuICB9O1xyXG59O1xyXG4iXSwKICAibWFwcGluZ3MiOiAiQUFDQSxTQUFTLFNBQVM7QUFDbEIsU0FBUyxVQUFVO0FBbUJaLE1BQU0sU0FBeUI7QUFBQSxFQUNwQyxNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixRQUFRO0FBQUEsRUFDUixhQUFhO0FBQUEsRUFDYixPQUFPLENBQUM7QUFBQSxFQUNSLE9BQU8sQ0FBQyxjQUFjO0FBQUEsRUFDdEIsWUFBWSxFQUFFLE9BQU87QUFBQSxJQUNuQixVQUFVLEVBQUUsT0FBTztBQUFBLElBQ25CLFVBQVUsRUFBRSxLQUFLLENBQUMsT0FBTyxNQUFNLENBQUM7QUFBQSxJQUNoQyxhQUFhLEVBQUUsT0FBTztBQUFBO0FBQUEsSUFDdEIsVUFBVSxFQUFFLE9BQU87QUFBQSxFQUNyQixDQUFDO0FBQUEsRUFDRCxnQkFBZ0I7QUFBQSxJQUNkLEtBQUssRUFBRSxPQUFPO0FBQUEsTUFDWixTQUFTLEVBQUUsT0FBTztBQUFBLE1BQ2xCLFVBQVUsRUFBRSxPQUFPO0FBQUEsTUFDbkIsUUFBUSxFQUFFLE9BQU87QUFBQSxJQUNuQixDQUFDO0FBQUEsSUFDRCxLQUFLLEVBQUUsT0FBTztBQUFBLE1BQ1osT0FBTyxFQUFFLE9BQU87QUFBQSxJQUNsQixDQUFDO0FBQUEsRUFDSDtBQUNGO0FBRUEsTUFBTSxnQkFBZ0IsSUFBSSxPQUFPO0FBRTFCLE1BQU0sVUFBdUMsT0FBTyxLQUFLLEVBQUUsT0FBTyxNQUFNO0FBQzdFLFFBQU0sRUFBRSxVQUFVLFVBQVUsYUFBYSxTQUFTLElBQUksSUFBSTtBQUUxRCxRQUFNLGFBQWEsSUFBSSxRQUFRO0FBQy9CLE1BQUksQ0FBQyxZQUFZO0FBQ2YsV0FBTztBQUFBLE1BQ0wsUUFBUTtBQUFBLE1BQ1IsTUFBTSxFQUFFLE9BQU8seUJBQXlCO0FBQUEsSUFDMUM7QUFBQSxFQUNGO0FBRUEsUUFBTSxRQUFRLFdBQVcsUUFBUSxXQUFXLEVBQUU7QUFDOUMsUUFBTSxVQUFVLEdBQUcsSUFBYSxZQUFZLEtBQUs7QUFDakQsTUFBSSxDQUFDLFNBQVM7QUFDWixXQUFPO0FBQUEsTUFDTCxRQUFRO0FBQUEsTUFDUixNQUFNLEVBQUUsT0FBTyxrQkFBa0I7QUFBQSxJQUNuQztBQUFBLEVBQ0Y7QUFFQSxNQUFJLFdBQVcsZUFBZTtBQUM1QixXQUFPO0FBQUEsTUFDTCxRQUFRO0FBQUEsTUFDUixNQUFNLEVBQUUsT0FBTyw4QkFBOEI7QUFBQSxJQUMvQztBQUFBLEVBQ0Y7QUFFQSxRQUFNLFdBQVcsVUFBVSxLQUFLLElBQUksQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ2hGLFFBQU0sYUFBWSxvQkFBSSxLQUFLLEdBQUUsWUFBWTtBQUV6QyxTQUFPLEtBQUsseUJBQXlCLEVBQUUsVUFBVSxVQUFVLFVBQVUsUUFBUSxRQUFRLE9BQU8sQ0FBQztBQUc3RixRQUFNLFVBQVUsdUNBQXVDLFFBQVEsSUFBSSxRQUFRO0FBRzNFLEtBQUcsSUFBWSxXQUFXLFVBQVU7QUFBQSxJQUNsQyxJQUFJO0FBQUEsSUFDSixRQUFRLFFBQVE7QUFBQSxJQUNoQjtBQUFBLElBQ0E7QUFBQSxJQUNBLFNBQVM7QUFBQSxJQUNULFFBQVE7QUFBQSxJQUNSLFlBQVk7QUFBQSxFQUNkLENBQUM7QUFHRCxRQUFNLFVBQVUsR0FBRyxJQUFTLGlCQUFpQixRQUFRLE1BQU0sS0FBSyxFQUFFLFFBQVEsUUFBUSxPQUFPO0FBQ3pGLFVBQVEsV0FBVztBQUNuQixLQUFHLElBQUksaUJBQWlCLFFBQVEsUUFBUSxPQUFPO0FBRS9DLFNBQU87QUFBQSxJQUNMLFFBQVE7QUFBQSxJQUNSLE1BQU07QUFBQSxNQUNKLFNBQVM7QUFBQSxNQUNUO0FBQUEsTUFDQSxRQUFRO0FBQUEsSUFDVjtBQUFBLEVBQ0Y7QUFDRjsiLAogICJuYW1lcyI6IFtdCn0K
