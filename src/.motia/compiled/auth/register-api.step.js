import { z } from "zod";
const config = {
  name: "RegisterAPI",
  type: "api",
  path: "/auth/register",
  method: "POST",
  description: "User registration endpoint",
  emits: ["user-registered"],
  flows: ["auth-flow"],
  bodySchema: z.object({
    email: z.string().email(),
    password: z.string().min(8),
    name: z.string().min(2)
  }),
  responseSchema: {
    201: z.object({
      message: z.string(),
      token: z.string(),
      user: z.object({
        id: z.string(),
        email: z.string(),
        name: z.string()
      })
    }),
    400: z.object({
      error: z.string()
    })
  }
};
const handler = async (req, { emit, logger, state }) => {
  const { email, password, name } = req.body;
  logger.info("User registration attempt", { email });
  const existingUser = await state.get("users", email);
  if (existingUser) {
    return {
      status: 400,
      body: { error: "User already exists" }
    };
  }
  const userId = `user_${Date.now()}_${Math.random().toString(36).substring(7)}`;
  const timestamp = (/* @__PURE__ */ new Date()).toISOString();
  const passwordHash = Buffer.from(password).toString("base64");
  await state.set("users", email, {
    id: userId,
    email,
    name,
    passwordHash,
    createdAt: timestamp,
    profile: null
  });
  const token = `jwt_${userId}_${Date.now()}_${Math.random().toString(36).substring(7)}`;
  await state.set("sessions", token, {
    userId,
    email,
    createdAt: timestamp,
    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1e3).toISOString()
  });
  await emit({
    topic: "user-registered",
    data: {
      userId,
      email,
      name,
      timestamp
    }
  });
  logger.info("User registered successfully", { userId, email });
  return {
    status: 201,
    body: {
      message: "User registered successfully",
      token,
      user: {
        id: userId,
        email,
        name
      }
    }
  };
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vYXV0aC9yZWdpc3Rlci1hcGkuc3RlcC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHR5cGUgeyBBcGlSb3V0ZUNvbmZpZywgSGFuZGxlcnMgfSBmcm9tICdtb3RpYSc7XHJcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQXBpUm91dGVDb25maWcgPSB7XHJcbiAgbmFtZTogJ1JlZ2lzdGVyQVBJJyxcclxuICB0eXBlOiAnYXBpJyxcclxuICBwYXRoOiAnL2F1dGgvcmVnaXN0ZXInLFxyXG4gIG1ldGhvZDogJ1BPU1QnLFxyXG4gIGRlc2NyaXB0aW9uOiAnVXNlciByZWdpc3RyYXRpb24gZW5kcG9pbnQnLFxyXG4gIGVtaXRzOiBbJ3VzZXItcmVnaXN0ZXJlZCddLFxyXG4gIGZsb3dzOiBbJ2F1dGgtZmxvdyddLFxyXG4gIGJvZHlTY2hlbWE6IHoub2JqZWN0KHtcclxuICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCksXHJcbiAgICBwYXNzd29yZDogei5zdHJpbmcoKS5taW4oOCksXHJcbiAgICBuYW1lOiB6LnN0cmluZygpLm1pbigyKVxyXG4gIH0pLFxyXG4gIHJlc3BvbnNlU2NoZW1hOiB7XHJcbiAgICAyMDE6IHoub2JqZWN0KHtcclxuICAgICAgbWVzc2FnZTogei5zdHJpbmcoKSxcclxuICAgICAgdG9rZW46IHouc3RyaW5nKCksXHJcbiAgICAgIHVzZXI6IHoub2JqZWN0KHtcclxuICAgICAgICBpZDogei5zdHJpbmcoKSxcclxuICAgICAgICBlbWFpbDogei5zdHJpbmcoKSxcclxuICAgICAgICBuYW1lOiB6LnN0cmluZygpXHJcbiAgICAgIH0pXHJcbiAgICB9KSxcclxuICAgIDQwMDogei5vYmplY3Qoe1xyXG4gICAgICBlcnJvcjogei5zdHJpbmcoKVxyXG4gICAgfSlcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgaGFuZGxlcjogSGFuZGxlcnNbJ1JlZ2lzdGVyQVBJJ10gPSBhc3luYyAocmVxLCB7IGVtaXQsIGxvZ2dlciwgc3RhdGUgfSkgPT4ge1xyXG4gIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkLCBuYW1lIH0gPSByZXEuYm9keTtcclxuICBcclxuICBsb2dnZXIuaW5mbygnVXNlciByZWdpc3RyYXRpb24gYXR0ZW1wdCcsIHsgZW1haWwgfSk7XHJcbiAgXHJcbiAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xyXG4gIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHN0YXRlLmdldCgndXNlcnMnLCBlbWFpbCk7XHJcbiAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzOiA0MDAsXHJcbiAgICAgIGJvZHk6IHsgZXJyb3I6ICdVc2VyIGFscmVhZHkgZXhpc3RzJyB9XHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICBjb25zdCB1c2VySWQgPSBgdXNlcl8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfWA7XHJcbiAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gIFxyXG4gIC8vIEhhc2ggcGFzc3dvcmQgKGluIHByb2R1Y3Rpb24sIHVzZSBiY3J5cHQpXHJcbiAgY29uc3QgcGFzc3dvcmRIYXNoID0gQnVmZmVyLmZyb20ocGFzc3dvcmQpLnRvU3RyaW5nKCdiYXNlNjQnKTsgLy8gU2ltcGxpZmllZCBmb3IgZGVtb1xyXG4gIFxyXG4gIC8vIFN0b3JlIHVzZXIgaW4gc3RhdGVcclxuICBhd2FpdCBzdGF0ZS5zZXQoJ3VzZXJzJywgZW1haWwsIHtcclxuICAgIGlkOiB1c2VySWQsXHJcbiAgICBlbWFpbCxcclxuICAgIG5hbWUsXHJcbiAgICBwYXNzd29yZEhhc2gsXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcclxuICAgIHByb2ZpbGU6IG51bGxcclxuICB9KTtcclxuICBcclxuICAvLyBHZW5lcmF0ZSBKV1QgdG9rZW4gZm9yIGF1dG8tbG9naW4gYWZ0ZXIgcmVnaXN0cmF0aW9uXHJcbiAgY29uc3QgdG9rZW4gPSBgand0XyR7dXNlcklkfV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfWA7XHJcbiAgXHJcbiAgLy8gU3RvcmUgc2Vzc2lvblxyXG4gIGF3YWl0IHN0YXRlLnNldCgnc2Vzc2lvbnMnLCB0b2tlbiwge1xyXG4gICAgdXNlcklkLFxyXG4gICAgZW1haWwsXHJcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCxcclxuICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcclxuICB9KTtcclxuICBcclxuICAvLyBFbWl0IGV2ZW50IGZvciBmdXJ0aGVyIHByb2Nlc3NpbmdcclxuICBhd2FpdCBlbWl0KHtcclxuICAgIHRvcGljOiAndXNlci1yZWdpc3RlcmVkJyxcclxuICAgIGRhdGE6IHtcclxuICAgICAgdXNlcklkLFxyXG4gICAgICBlbWFpbCxcclxuICAgICAgbmFtZSxcclxuICAgICAgdGltZXN0YW1wXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgXHJcbiAgbG9nZ2VyLmluZm8oJ1VzZXIgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHknLCB7IHVzZXJJZCwgZW1haWwgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXR1czogMjAxLFxyXG4gICAgYm9keToge1xyXG4gICAgICBtZXNzYWdlOiAnVXNlciByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseScsXHJcbiAgICAgIHRva2VuLFxyXG4gICAgICB1c2VyOiB7XHJcbiAgICAgICAgaWQ6IHVzZXJJZCxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICBuYW1lXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG59O1xyXG4iXSwKICAibWFwcGluZ3MiOiAiQUFD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
